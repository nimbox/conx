# conx

A command line utility to develop and test nimbox connectors.

## Getting Started

1. Install the `conx` utility program:

    ```bash
    brew install nimbox/public/conx
    ```

2. Create a working directory and move to it.

3. Create a minimal configuration file (`configuration.json`) with the following
   structure. The `configuration` part of the file corresponds to the same
   configuration used in the application. Bare in mind that the
   `host.docker.internal` needs to be used in case there is a tunnel from the
   server running docker to the server hosting the remote database.

    ```yaml
    business:
      country: DO
      currency: DOP
      currencies:
      - USD
      - EUR
      locale: es
    connector:
      streamer:
        contacts:
          representative:
            phones: 3
            emails: 1
            addresses: 0
          customer:
            phones: 3
            emails: 1
            addresses: 1
          customerContact:
            phones: 3
            emails: 3
            addresses: 1
    configuration:
      version: 1
      url: jdbc:sqlserver://host.docker.internal;databaseName=CONNECTOR
      reader:
        username: sa
        password: Password1!
      renderer: FREEMARKER
      database:
        currencies:
        - value: DOP
          patterns: 
          - RD$
    ```

4. Start the connector server with the following command:

    ```bash
    conx start configuration.json .
    ```
5. Create the first query using the template provided by:

    ```bash
    conx sql template Warehouse
    ```
6. Test reading the query with:

    ```bash
    conx sync --wait Warehouse
    ```

7. Check the parser result with:

    ```bash
    conx show parsers
    conx show disparities Warehouse
    ```

8. If you have all the queries available in your working directory then launch a
   sync command and wait for the completion:
     
    ```bash
    conx sync --wait
    ```
9. To check the logs being generated by the connector, use the following
   command:

    ```bash
    docker logs -f connector-server
    ```

10. To terminate or restart the whole process, use the following commands:

    ```bash
    conx stop
    conx start configuration.json .
    ```

11. Add autocomplete to your shell by following the instructions in:

    ```bash
    conx completion --help
    conx completion zsh --help
    ```
    In OSX make sure your `~/.zshrc` starts with:
    ```bash
    fpath=($(brew --prefix)/share/zsh/site-functions $fpath)
    autoload -U compinit; compinit
    ```
    And that you execute:
    ```bash
    conx completion zsh > $(brew --prefix)/share/zsh/site-functions/_conx
    ```
